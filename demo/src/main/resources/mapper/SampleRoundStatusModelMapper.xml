<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.studentdemo.mapper.SampleRoundStatusModelMapper">

    <select id="getTaskInfo" resultType="com.example.studentdemo.entity.SampleRoundStatusModel">--
    select t.createTime as createTime,
           t.updateTime as updateTime,
           task.task_name
        from
        (select min(s1.create_time) as createTime,
               max(s2.update_time) as updateTime,
               s1.task_id as taskId
            from sample_round_status s1
            left join sample_round_status s2
    --         on s1.task_id = s2.task_id
    --         and s1.status = 'start'
    --         and s2.status = 'end'
    --         and s2.round = (select round from task where s1.task_id = task.id)
                      on s1.status = 'start'
                          and s1.task_id = s2.task_id
                          and s2.status = 'end'
                          and s2.round = (select round from task where s1.task_id = task.id)
    --             and s2.round = (select round from task where task.id = s1.task_id)
            group by s1.task_id) t
            inner join task
            on t.taskId = task.id

    </select>
    <select id="getSampleInfo" resultType="com.example.studentdemo.entity.SampleRoundStatusModel">

        select min(s1.create_time) as createTime,
                max(s2.update_time) as updateTime,
                max(s1.round) as round,
                s1.sample_id as sampleId
         from sample_round_status s1
                  left join sample_round_status s2
             --         on s1.task_id = s2.task_id
             --         and s1.status = 'start'
             --         and s2.status = 'end'
             --         and s2.round = (select round from task where s1.task_id = task.id)
                            on s1.status = 'start'
                                and s1.sample_id = s2.sample_id
                                and s2.status = 'end'
                                and s2.round = (select round from task where s1.task_id = task.id)
                                and s1.task_id = #{id}
                                and s1.task_id = s2.task_id
         --             and s2.round = (select round from task where task.id = s1.task_id)
         group by s1.sample_id
    </select>
</mapper>